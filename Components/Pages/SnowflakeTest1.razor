@page "/snowflake-test1"
@using System.Data
@inject PartTracker.Shared.Services.SnowflakeService Snowflake
 
<h3>Snowflake Connection Test</h3>
 
<button @onclick="RunTest">Run test query</button>
 
@if (_result != null)
{
<h4>Snowflake Session Context</h4>
 
    <table border="1" cellpadding="8" style="border-collapse:collapse; max-width:600px;">
<tbody>
            @foreach (DataColumn col in _result.Columns)
            {
<tr>
<td style="font-weight:bold; background:#f4f4f4; width:200px;">
                        @col.ColumnName
</td>
<td>
                        @_result.Rows[0][col]
</td>
</tr>
            }
</tbody>
</table>
}
 
 
<hr />
 
 
 
@if (!string.IsNullOrWhiteSpace(_createMessage))
{
<p style="margin-top:10px;"><b>@_createMessage</b></p>
}
 
@code {
    // ===== Connection test =====
    private bool _loading;
    private string? _error;
    private DataTable? _result;
 
    // ===== Create table =====
    private string? newTableName;
    private string? col1;
    private string? col2;
    private string? col3;
    private string? col4;
    private string? _createMessage;
 
    private async Task RunTest()
    {
        _loading = true;
        _error = null;
        _result = null;
 
        try
        {
            _result = await Snowflake.QueryAsync(@"
SELECT
  CURRENT_ROLE()      AS ROLE,
  CURRENT_USER()      AS USERNAME,
  CURRENT_WAREHOUSE() AS WAREHOUSE,
  CURRENT_DATABASE()  AS DATABASE,
  CURRENT_SCHEMA()    AS SCHEMA
");
 
         
 
        }
        catch (Exception ex)
        {
            _error = ex.Message;
        }
        finally
        {
            _loading = false;
        }
    }
 
   
}