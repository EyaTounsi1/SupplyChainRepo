@page "/forecast-digital-twin"
@layout MainLayout
@inject IForecastService ForecastService

<MudText Typo="Typo.h3">Forecast & Digital Twin</MudText>

@if (isLoading)
{
    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
    <MudText>Loading forecast data...</MudText>
}
else if (!string.IsNullOrEmpty(errorMessage))
{
    <MudAlert Severity="Severity.Error">@errorMessage</MudAlert>
}
else
{
    <MudTable Items="@forecastItems" Hover="true" Striped="true">
        <HeaderContent>
            <MudTh>Site</MudTh>
            <MudTh>Part Number</MudTh>
            <MudTh>Date</MudTh>
            <MudTh>WIP Balance</MudTh>
            <MudTh>GIT Balance</MudTh>
            <MudTh>Total Capital (M SEK)</MudTh>
            <MudTh>Safety Stock</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>@context.Site</MudTd>
            <MudTd>@context.Part_Number</MudTd>
            <MudTd>@context.Date.ToShortDateString()</MudTd>
            <MudTd>@context.Wip_Balance.ToString("N0")</MudTd>
            <MudTd>@context.Git_Balance.ToString("N0")</MudTd>
            <MudTd>@context.Total_Capital_M_Sek.ToString("N2")</MudTd>
            <MudTd>@context.Safety_Stock_Nr_Of_Parts?.ToString("N0")</MudTd>
        </RowTemplate>
    </MudTable>
}

@code {
    private List<ForecastItem> forecastItems = new();
    private bool isLoading = true;
    private string errorMessage = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            forecastItems = await ForecastService.GetForecastDataAsync();
        }
        catch (Exception ex)
        {
            errorMessage = $"Error loading forecast data: {ex.Message}";
        }
        finally
        {
            isLoading = false;
        }
    }
}